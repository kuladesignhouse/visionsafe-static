{% extends "layout.njk" %}

{% block meta %}
  <meta name="description" content="Loaner program for Emergency Vision Assurance System (EVAS).">
{% endblock %}

{% block title %}2025 EVAS Van Tour | VisionSafe{% endblock %}

{% block head %}
  {% include "partials/head.njk" %}
  <link rel="stylesheet" type="text/css" href="/css/checkout.css">

<script src="/extras/current.js"></script>
<script src="/extras/sub-current.js"></script>
<script defer data-domain="visionsafe.com" src="https://plausible.io/js/script.js"></script>

  <link rel="stylesheet" href="https://use.typekit.net/hsf5yko.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
<style>
#img-header {
  width: 100%;
  display: flex;
}
#img-header > img {
  width: 100%;
  height: auto;
}

.vantainer {
  max-width: 60rem;
  margin: auto;
  padding: 20px;
}

.vantainer h1 {
  text-align: left;
  margin: 50px 0 20px 0;
  font-family: basic-sans, sans-serif;
  font-style: normal;
  font-weight: 700;
  font-size: 36px;
  line-height: 43px;
  color: #000000;
}

.vantainer p {
  font-family: basic-sans, sans-serif;
  font-style: normal;
  font-weight: 400;
  font-size: 18px;
  line-height: 24px;
  color: #000000;
  margin: 0;
}
.vantainer h2 {
  margin: 20px 0;
  font-family: basic-sans, sans-serif;
  font-style: normal;
  font-weight: 700;
  font-size: 24px;
  line-height: 29px;
  color: #000000; 
}

.vidninfo {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 15px;
  flex-direction: column;
}

.iconinfo {
  display: flex;
  align-items: center;
  gap: 12px;
}
.vaninfo {
  display: flex;
  align-items: center;
  margin-bottom: 100px;
  flex-direction: column-reverse;
}
.vaninfoleft p {
  margin: 20px 0 30px;
}
.vaninfoleft a.request-demo {
  margin-top: 10px;
}
.vaninforight {
  position: relative;
  width: 100%;
}
.vaninforight img {
  margin-left: 10%;
  margin-bottom: -10%;
}
.vaninfo a img {
  width: 100%;
  height: auto;
}
.vidninfo a#show-vimeo img {
  width: 100%;
  height: auto;
  max-width: 448px;
}
@media (min-width: 60rem) {
  .vaninfo {
    flex-direction: row;
  }
  .vaninforight img {
    position: absolute;
    top: -145px;
    left: -230px;
    max-width: 730px;
    height: auto;
    margin: 0;
  }
  .vidninfo {
    flex-direction: row;
  }
  .vidninfo > div {
    max-width: calc(100% - 463px);
  }
}


.layout-container {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  width: 100%;
}
.list-item {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
}
.icon-container {
  margin-right: 10px;
}
.icon-container img {
  width: 20px; /* Adjust the size as needed */
  height: auto;
}
.item-text {
  margin-left: 0px;

  font-family: basic-sans, sans-serif;
  font-style: normal;
  font-weight: 700;
  font-size: 18px;
  line-height: 24px;
  color: #000000;
}







.responsive-table {
  overflow-x: auto;
}

.responsive-table table {
  width: 100%;
  border-collapse: collapse;
  font-family: sans-serif;
}

.responsive-table th, .responsive-table td {
  padding: 12px 16px;
  text-align: left;
  border-bottom: 1px solid #828282;
}

.responsive-table thead {
  font-family: basic-sans, sans-serif;
  font-style: normal;
  font-weight: 700;
  font-size: 20px;
  line-height: 24px;
  color: #000000;
}

.responsive-table tbody tr:nth-child(even) {
  background: #F5F5F5;
}

.responsive-table td {
  font-family: basic-sans, sans-serif;
  font-style: normal;
  font-weight: 600;
  font-size: 18px;
  line-height: 22px;
  color: #000000;
}

/* Responsive: stack cells on narrow screens */
@media (max-width: 37.5rem) {
  .responsive-table table, .responsive-table thead, .responsive-table tbody, .responsive-table th, .responsive-table td, .responsive-table tr {
    display: block;
  }

  .responsive-table thead tr {
    display: none;
  }

  .responsive-table tbody tr {
    margin-bottom: 1rem;
    border-bottom: 2px solid #828282;
  }

  .responsive-table td {
    position: relative;
    padding-left: 50%;
  }

  .responsive-table td::before {
    content: attr(data-label);
    position: absolute;
    left: 16px;
    top: 12px;
    white-space: nowrap;

    font-family: basic-sans, sans-serif;
    font-style: normal;
    font-weight: 600;
    font-size: 18px;
    line-height: 22px;
    color: #000000;
  }
}








a.request-demo {
  max-width: 399px;
  min-height: 56px;
  background: linear-gradient(140.44deg, #FFF7CB 12.07%, #FAE493 60.95%);

  display: flex;
  justify-content: center;
  align-items: center;

  text-decoration: none;
  cursor: pointer;
  display: flex;

  margin: 0 0 23px;

  border-radius: 10px;
  border: 1px solid #000;
  padding: 13px 31px 15px 29px;

  font-family: "Lato", sans-serif;
  font-weight: 700;
  font-size: 18px;
  color: #000;
}
.modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.7);
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.modal-content {
  background-color: #F7F7F7;
  padding: 20px;
  border: 1px solid #888;
  border-radius: 20px;
  width: 80%;
  position: relative;
  max-height: 100vh;
  max-width: 520px;
}

.close-demo {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  right: 10px;
  top: -3px;
}

.close-demo:hover,
.close-demo:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

form#demo {
  height: 100%;
  /*overflow-y: auto;*/
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
}

form#demo > div {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  width: 100%;
  flex-grow: 1;
}

div.input-spacer {
  display: flex;
  flex-direction: column;
  justify-content: space-around;
  flex-grow: 1;
}

div.input-spacer > div {
  margin-bottom: 8px;
}

form#demo input {
  width: 100%;
}

form#demo h1 {
  font-family: 'Lato';
  font-style: normal;
  font-weight: 700;
  font-size: 15px;
  text-align: center;
  color: #000000;
  width: 100%;
  /*margin-bottom: 20px;*/
}

form#demo label {
  font-family: 'Lato';
  font-style: normal;
  font-weight: 700;
  font-size: 18px;
  line-height: 22px;
  color: #000000;
}

form#demo label span {
  font-weight: 300;
}

form#demo input[type="text"],
form#demo input[type="email"],
form#demo input[type="tel"] {
  margin: 6px 0 0px;
  box-sizing: border-box;
  background: #FFFFFF;
  border: 1px solid #AAAAAA;
  border-radius: 10px;
}

form#demo input[type="submit"] {
  box-sizing: border-box;
  background: linear-gradient(140.44deg, #FFF7CC 12.07%, #FAE28C 60.95%);
  border: 1px solid #AAAAAA;
  border-radius: 10px;
  font-family: 'Roboto';
  font-style: normal;
  font-weight: 700;
  font-size: 24px;
  text-align: center;
  height: 42px;
  /*margin-top: 35px;*/
}

form#demo input[type="submit"].validated {
  color: rgba(27, 27, 27, 1);
}

div#demoModal.modal.successful form#demo {
  display: none;
}

div#demoModal.modal.successful .modal-content {
  width: 80%;
  height: 176px;
}

#demoModal > div > div.success-msg {
  display: none;
}

#demoModal.successful > .modal-content {
  padding: 20px;
}

#demoModal.successful > div > div.success-msg {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
  position: relative;
}

#demoModal.successful > div > div.success-msg h1 {
  font-family: 'Lato', sans-serif;
  font-style: normal;
  font-weight: 700;
  font-size: 26px;
  line-height: 31px;
  text-align: center;
  color: #000000;
}

@media (min-width: 21.875rem) {
  form#demo h1 {
    font-size: 16px;
  }
}

@media (min-width: 24rem) {
  form#demo h1 {
    font-size: 18px;
  }
  a.request-demo {
    font-size: 23px;
    white-space: nowrap;
  }
}

@media (min-width: 26rem) {
  form#demo h1 {
    font-size: 20px;
  }
  div.input-spacer > div {
    margin-bottom: 18px;
  }
}

@media (min-width: 33rem) {
  div#demoModal.modal.successful .modal-content {
    max-width: 522px;
  }
  form#demo h1 {
    font-size: 24px;
  }
}

@media (min-width: 40rem) {
  form#demo h1 {
    font-size: 26px;
    line-height: 31px;
    /*margin-bottom: 40px;*/
  }
  form#demo input[type="submit"] {
    font-size: 32px;
    line-height: 38px;
    height: 62px;
    /*margin-top: 50px;*/
  }
  form#demo input[type="text"],
  form#demo input[type="email"],
  form#demo input[type="tel"] {
    height: 57px;
    margin: 6px 0 0px;
  }
  .close-demo {
    right: 1rem;
    top: 0.5rem;
  }
}
@media (min-height: 660px) {
  .modal-content {
    padding: 67px;
    max-width: 520px;
    max-height: 650px;
  }
}

.success-message {
  background-color: #4CAF50;
  color: white;
  padding: 15px;
  border-radius: 5px;
  margin-bottom: 15px;
  display: none;
}
.error-message {
  background-color: #f44336;
  color: white;
  padding: 15px;
  border-radius: 5px;
  margin-bottom: 15px;
  display: none;
}




/* Video Modal CSS - Add this to your existing styles */
#videoModal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.8);
  /* Center the modal content when shown */
  align-items: center;
  justify-content: center;
}

#videoModal.show {
  display: flex;
}

#videoModal .modal-content {
  position: relative;
  width: 90%;
  max-width: 800px;
  background: transparent;
  border: none;
  padding: 0;
}

/* Close button for video modal */
#videoModal .close-video {
  position: absolute;
  top: -50px;
  right: -10px;
  color: white;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
  z-index: 1000;
  background: rgba(0,0,0,0.7);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.3s;
  border: 2px solid rgba(255,255,255,0.3);
  line-height: 1;
  font-family: Arial, sans-serif;
}

#videoModal .close-video:hover {
  background: rgba(255,255,255,0.2);
  color: #fff;
}

/* Video wrapper for responsive 16:9 aspect ratio */
#videoModal .video-wrapper {
  position: relative;
  padding-bottom: 56.25%; /* 16:9 aspect ratio */
  height: 0;
  overflow: hidden;
  background: #000;
  border-radius: 8px;
}

#videoModal .video-wrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
  border-radius: 8px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  #videoModal .modal-content {
    width: 95%;
    margin: 0 10px;
  }
  
  #videoModal .close-video {
    top: -45px;
    right: -5px;
    font-size: 28px;
    width: 35px;
    height: 35px;
  }
}

@media (max-width: 480px) {
  #videoModal .modal-content {
    width: 98%;
    margin: 0 5px;
  }
  
  #videoModal .close-video {
    top: -40px;
    right: 0;
    font-size: 24px;
    width: 32px;
    height: 32px;
  }
}

@media (min-width: 1200px) {
  #videoModal .modal-content {
    width: 70%;
    max-width: 1000px;
  }
}
</style>
{% endblock %}

{% block content %} 
  <div id="img-header">
    <img src="imgs/evas-van-tour-2025.jpg">
  </div>

  <div class="vantainer">
    <h1>Experience EVAS in Action: The EVAS Van Tour</h1>
    <div class="vidninfo">
      <a id="show-vimeo">
        <img src="imgs/EVAS-van-tour-video-thumb.png">
      </a>
      <div>
        <h2>See Through the Smoke</h2>
        <p>VisionSafe's EVAS Demonstration Van is on the road, bringing the power of the Emergency Vision Assurance System directly to aviation professionals across the country.</p>
        <br>
        <p>Step inside one of our custom-outfitted vans, featuring a cockpit designed to simulate a real in-flight smoke emergency. Watch the cabin fill with dense smoke — then see how EVAS instantly restores a clear, see-through environment, allowing pilots to view vital instruments and safely see out the windshield.</p>
      </div>
    </div>

    <div class="iconinfo">
      <img src="imgs/pin.svg" width="23.02" height="31.38">
      <h2>Van Tour Schedule</h2>
    </div>

<div class="responsive-table">
	<table>
		<thead>
			<tr>
				<th>Date</th>
				<th>Event/Airport Code</th>
				<th>Location</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td data-label="Date">November 10–14</td>
				<td data-label="Event/Airport Code">Bombardier Safety Symposium</td>
				<td data-label="Location">Wichita, KS</td>
			</tr>
			<tr>
				<td data-label="Date">November 17–21</td>
				<td data-label="Event/Airport Code">—</td>
				<td data-label="Location">Atlanta, GA – Charlotte, NC</td>
			</tr>
			<tr>
				<td data-label="Date">December 1–5</td>
				<td data-label="Event/Airport Code">—</td>
				<td data-label="Location">Denver, CO</td>
			</tr>
			<tr>
				<td data-label="Date">December 3–5</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">Savannah, GA</td>
			</tr>
			<tr>
				<th style="font-size:22px">2026</th>
				<th></th>
				<th></th>
			</tr>
			<tr>
				<td data-label="Date">January 12–16</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">Miami/Ft Lauderdale</td>
			</tr>
			<tr>
				<td data-label="Date">January 16–30</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">So Cal</td>
			</tr>
			<tr>
				<td data-label="Date">February 9–13</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">Orlando</td>
			</tr>
			<tr>
				<td data-label="Date">February 10–12</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">Mexico City</td>
			</tr>
			<tr>
				<td data-label="Date">February 24</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">Miami Opa Locka</td>
			</tr>
			<tr>
				<td data-label="Date">March 9–13</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">Phoenix</td>
			</tr>
			<tr>
				<td data-label="Date">March 23–27</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">Dallas</td>
			</tr>
			<tr>
				<td data-label="Date">April 6–10</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">Charlotte</td>
			</tr>
			<tr>
				<td data-label="Date">April 17–19</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">Orlando</td>
			</tr>
			<tr>
				<td data-label="Date">April 20–25</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">Houston</td>
			</tr>
			<tr>
				<td data-label="Date">April 29 – April 30</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">Dallas</td>
			</tr>
			<tr>
				<td data-label="Date">May 5–6</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">Provo, UT</td>
			</tr>
			<tr>
				<td data-label="Date">June 3</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">White Plains, NY</td>
			</tr>
			<tr>
				<td data-label="Date">June 15–19</td>
				<td data-label="Event/Airport Code"></td>
				<td data-label="Location">New England</td>
			</tr>
		</tbody>
	</table>
</div>

<div class="iconinfo">
	<img height="31.38" src="imgs/schedule.svg" width="23.02">
	<h2>Schedule a Stop By Your Hangar or Location</h2>
</div>
<div class="vaninfo">
	<div class="vaninfoleft">
		<p>If you're located near one of our upcoming stops, we may be able to bring the EVAS Van directly to your location. Perfect for flight departments, FBOs, training teams, and anyone responsible for flight safety.</p>
		<div class="layout-container">
			<div class="list-item">
				<div class="icon-container"><img src="imgs/plane.svg"></div>
				<div class="item-text">
					Personalized demonstration at your location
				</div>
			</div>
			<div class="list-item">
				<div class="icon-container"><img src="imgs/plane.svg"></div>
				<div class="item-text">
					Fast, impactful training for pilots and crews
				</div>
			</div>
			<div class="list-item">
				<div class="icon-container"><img src="imgs/plane.svg"></div>
				<div class="item-text">
					EVAS deployment in a smoke-filled cockpit
				</div>
			</div>
		</div><a class="request-demo">Request a Demo at Your Location</a>
	</div>
	<div class="vaninforight"><img src="imgs/evas-van.png"></div>
</div>

{% include "partials/footer.njk" %}

<div id="demoModal" class="modal">
  <div class="modal-content">
    <div class="success-msg">
      <h1>Great! We will reach out soon to book your demo.</h1>
    </div>
    <form id="demo">
      <span class="close-demo">&times;</span>
      <h1>Learn more about EVAS and see<br>exactly how EVAS works</h1>
      <div>
        <div class="input-spacer">
          <div>
            <label for="fullName">Full Name</label>
            <input type="text" id="fullName" name="fullName">
          </div>
          <div>
            <label for="businessEmail">Business Email</label>
            <input type="email" id="businessEmail" name="businessEmail">
          </div>
          <div>
            <label for="phone">Phone <span>(optional)</span></label>
            <input type="tel" id="phone" name="phone">
          </div>
          <div>
            <label for="address">Address <span>(optional)</span></label>
            <input type="text" id="address" name="address">
          </div>
        </div>
        <div id="successMessage" class="success-message">Thank you! Your request has been submitted successfully.</div>
        <div id="errorMessage" class="error-message">Oops! Something went wrong. Please try again or contact support.</div>
        <input type="submit" value="Send Request" id="submitBtn">
      </div>
    </form>
  </div>
</div>

<div id="videoModal" class="modal">
  <div class="modal-content">
    <span class="close-video">&times;</span>
    <div class="video-wrapper">
      <iframe id="vimeoPlayer"
              src="" 
              frameborder="0" 
              allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; web-share" 
              referrerpolicy="strict-origin-when-cross-origin" 
              title="Van Demo Commercial">
      </iframe>
    </div>
  </div>
</div>

<div class="reveal" id="checkoutModal" >
  <button class="close-button" data-close aria-label="Close reveal" type="button">
    <span aria-hidden="true">&times;</span>
  </button>
  <div id="airload"></div>
  <h1 id="checkoutheader">Great! We'll guide you through the steps to getting your plane or fleet protected with EVAS.</h1>
  <form id="checkout" name="checkout">
    <label>Contact Information</label>
    <div class="form-input">
      <input id="fullname" name="fullname" placeholder="Full Name" required="required" type="text">
      <label for="fullname">Full Name</label>
    </div>
    <div class="form-input">
      <input id="company" name="company" placeholder="Company" required="required" type="text">
      <label for="company">Company</label>
    </div>
    <div class="form-input">
      <input id="phone" name="phone" placeholder="Phone" required="required" type="tel">
      <label for="phone">Phone</label>
    </div>
    <div class="form-input">
      <input id="email" name="email" placeholder="Email" required="required" type="email">
      <label for="email">Email</label>
    </div>
    
    <label class="slct">Where is your plane or fleet registered?</label>
    <div class="form-input">
      <select name="location">
        <option selected="selected" value="0">Select country</option>
        <option value="US">United States</option>
        <option value="EU">European Union</option>
        <option value="OTHER">Other</option>
      </select>
    </div>
    <label class="notshown" id="countrylabel">What country is your plane or fleet registered in?</label>
    {% include "partials/countries.njk" %}
    <div class="form-sub">
      <input type="submit" value="Next" />
    </div>
  </form>
</div>
<div class="reveal" id="msgModal" data-reveal data-close-on-click="true" data-animation-in="fade-in" data-animation-out="fade-out">
  <div class="modal-wrap">
    <div id="msg-modal-error">
      <h2>We'll need to get you a special STC for where your aircraft is registered. We will be in touch shortly to assist with this. If you'd like to contact us please call us at 1-800-441-9230</h2>
    </div>    
    <button class="close-button" data-close aria-label="Close reveal" type="button">
      <span aria-hidden="true">&times;</span>
    </button>  
  </div>
</div>
<div class="reveal" id="stripeModal" data-reveal data-close-on-click="true" data-animation-in="fade-in" data-animation-out="fade-out">
  <div class="modal-wrap">
    <div id="msg-modal-stripe"></div>
  </div>
</div>
{% endblock %}

{% block javascript %} 
<script src="/js/webflow.js" type="text/javascript"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/outofview.js"></script>
<script src="/js/what-input.min.js"></script>
<script src="/js/foundation.min.js"></script>
<script>$(document).foundation();</script>
<script src="/js/checkout.js"></script>

<!-- LinkedIn Insight Tag -->
<script type="text/javascript">
_linkedin_partner_id = "441156";
window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || [];
window._linkedin_data_partner_ids.push(_linkedin_partner_id);
</script><script type="text/javascript">
(function(){var s = document.getElementsByTagName("script")[0];
var b = document.createElement("script");
b.type = "text/javascript";b.async = true;
b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js";
s.parentNode.insertBefore(b, s);})();
</script>
<noscript>
<img height="1" width="1" style="display:none;" alt="" src="https://dc.ads.linkedin.com/collect/?pid=441156&fmt=gif" />
</noscript>
<!-- End LinkedIn Insight Tag -->

<!-- Twitter universal website tag code -->
<script>
!function(e,t,n,s,u,a){e.twq||(s=e.twq=function(){s.exe?s.exe.apply(s,arguments):s.queue.push(arguments);
},s.version='1.1',s.queue=[],u=t.createElement(n),u.async=!0,u.src='//static.ads-twitter.com/uwt.js',
a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(u,a))}(window,document,'script');
// Insert Twitter Pixel ID and Standard Event data below
twq('init','o31f6');
twq('track','PageView');
</script>
<!-- End Twitter universal website tag code -->

<!-- birdseed 
<script id="io.birdseed.script-tag" type="text/javascript" src="https://app.birdseed.io/widget.js"></script><div id="birdseed-widget-container" data-token="100d60c95c9b87ccc8463ae09bb6dd61"></div>
 end birdseed -->

<script src="https://player.vimeo.com/api/player.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const demoModal = document.getElementById('demoModal');
  const videoModal = document.getElementById('videoModal');
  const demoForm = document.getElementById('demo');
  const requestButtons = document.querySelectorAll('.request-demo');
  const closeDemos = document.querySelectorAll('.close-demo');
  const closeVideo = document.querySelector('#videoModal .close-video');
  const showVimeoButton = document.getElementById("show-vimeo");

  // Video player variables
  const iframe = videoModal.querySelector("iframe");
  let player = null;
  let isPlayerReady = false;

  // Demo modal functionality
  requestButtons.forEach(button => {
    button.addEventListener('click', () => {
      if (demoModal.classList.contains("successful")) {
        demoModal.classList.remove("successful");
      }
      demoModal.style.display = "flex";
      document.body.style.overflow = 'hidden';
    });
  });

  function closeDemoModal() {
    demoModal.style.display = "none";
    document.body.style.overflow = '';
  }

  closeDemos.forEach(button => {
    button.addEventListener('click', closeDemoModal);
  });

  // Video modal functionality - FIXED VERSION
  function initializePlayer() {
    // Set iframe src when opening modal to avoid autoplay issues
    iframe.src = "https://player.vimeo.com/video/1086602949?h=99cc9f01a2&badge=0&autopause=0&player_id=0&app_id=58479";
    
    // Small delay to ensure iframe loads
    setTimeout(() => {
      player = new Vimeo.Player(iframe);
      
      player.ready().then(function() {
        console.log("Player is ready");
        isPlayerReady = true;
        
        // Auto-play when ready
        return player.play();
      }).then(function() {
        console.log("Video started playing successfully");
      }).catch(function(error) {
        console.error("Error with video playback:", error);
        switch (error.name) {
          case 'PasswordError':
            console.error('Error: The video is password-protected.');
            break;
          case 'PrivacyError':
            console.error('Error: The video is private.');
            break;
          default:
            console.error('An unknown error occurred while playing the video.', error);
            break;
        }
      });

      // Optional: Add event listeners for debugging
      player.on('play', function() {
        console.log('Video played');
      });

      player.on('pause', function() {
        console.log('Video paused');
      });

      player.on('ended', function() {
        console.log('Video ended');
      });

    }, 500); // Small delay to ensure iframe is properly loaded
  }

  function closeVideoModal() {
    videoModal.classList.remove('show');
    document.body.style.overflow = '';
    
    // Properly pause and cleanup
    if (player && isPlayerReady) {
      player.pause().then(function() {
        console.log("Video paused successfully.");
      }).catch(function(error) {
        console.error("Error pausing the video:", error);
      });
    }
    
    // Clear iframe src and reset player after a short delay
    setTimeout(() => {
      iframe.src = "";
      player = null;
      isPlayerReady = false;
    }, 100);
  }

  // Video modal event listeners
  showVimeoButton.addEventListener('click', (e) => {
    e.preventDefault();
    videoModal.classList.add('show');
    document.body.style.overflow = 'hidden';
    
    // Initialize player fresh each time modal opens
    initializePlayer();
  });

  if (closeVideo) {
    closeVideo.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      closeVideoModal();
    });
  }

  videoModal.addEventListener('click', (e) => {
    if (e.target === videoModal) {
      closeVideoModal();
    }
  });

  demoModal.addEventListener('click', (e) => {
    if (e.target === demoModal) {
      closeDemoModal();
    }
  });

  // Global keyboard event handlers
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      if (demoModal.style.display === "flex") {
        closeDemoModal();
      }
      if (videoModal.classList.contains('show')) {
        closeVideoModal();
      }
    }
  });

  // Form submission functionality
  const submitBtn = document.getElementById('submitBtn');
  const successMessage = document.getElementById('successMessage');
  const errorMessage = document.getElementById('errorMessage');

  demoForm.addEventListener('submit', function(e) {
    e.preventDefault();
  
    successMessage.style.display = 'none';
    errorMessage.style.display = 'none';
    
    submitBtn.disabled = true;
    submitBtn.value = 'Submitting...';

    const form = e.target;
    const data = new URLSearchParams();

    [...form.elements].forEach(el => {
      if (el.name) {
        data.append(el.name, el.value);
      }
    });

    data.append('timestamp', new Date().toISOString());

    const callbackName = 'jsonpCallback_' + Math.floor(Math.random() * 100000);
    data.append('callback', callbackName);

    window[callbackName] = function(response) {
      submitBtn.disabled = false;
      submitBtn.value = 'Send Request';
      submitBtn.style.display = 'none';
      successMessage.style.display = 'block';
      demoForm.reset();
      successMessage.scrollIntoView({ behavior: 'smooth' });
      delete window[callbackName];
    };

    const script = document.createElement('script');
    script.src = 'https://script.google.com/macros/s/AKfycbwzGjFMvjLVDLYUiTramN6NM4mOlBlSHimwI-0Fvt26zJBvoQM_OTZdsJxJeAFJCLeW/exec?' + data.toString();
    document.body.appendChild(script);
  });
});
</script>
{% endblock %}